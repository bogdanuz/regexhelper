# Спецификация визуализатора — RegexHelper

Подробное описание требований к инструменту «Визуализатор»: что делает, как работает, что должен делать. Референс: [regexper.com](https://regexper.com/).

**Дата создания:** 2026-02-17

---

## 1. Назначение

Инструмент для визуализации регулярных выражений в виде railroad-диаграмм. Пользователь вводит готовый regex и получает графическое представление его структуры. Полностью независимый инструмент (отдельная папка в `tools/visualizer/`), не связан с результатом конвертера.

---

## 2. Размещение и структура

### 2.1 Расположение в приложении

- **Отдельная секция** между `#converter-section` и `#history-section`.
- ID секции: `#visualizer`.
- Ширина: на всю ширину экрана (аналогично панели «Связанные триггеры»).
- Расстояние между секциями разных инструментов — больше, чем между секциями одного инструмента.

### 2.2 Высота и прокрутка панели

- **До построения диаграммы:** высота области диаграммы адаптивна по размеру экрана (min-height/min(280px, 35vh), max-height 60vh), чтобы панель целиком помещалась на экране.
- **После построения диаграммы:** область увеличивается (min-height min(960px, 75vh), max-height min(1260px, 85vh)) для удобного просмотра больших диаграмм.
- Внутри панели — **скролл** по горизонтали и вертикали; при зуме размер области прокрутки задаётся явно, чтобы диаграмму можно было двигать до всех краёв.
- **Zoom** (уменьшить/увеличить): диапазон 25%–300%; кнопки с подсказкой о возможности менять масштаб колёсиком мыши при зажатой клавише Ctrl.
- При первой отрисовке: **fit to view** — вся диаграмма помещается в область; если маленькая — показывается с отступами; если большая — авто-зум в минус, чтобы видеть всё.

### 2.3 Навигация

- Клик по «Визуализатор» в header → smooth scroll к `#visualizer`.
- При скролле к секции визуализатора ссылка «Визуализатор» подсвечивается как активная (подчёркивание, как у «Конвертер»).

### 2.4 Раскрытие/сворачивание

- Кнопка «Свернуть/развернуть» **не требуется**.

---

## 3. Поле ввода regex

### 3.1 Поведение

- **Независимое** поле ввода — не синхронизируется с результатом конвертера.
- Полностью редактируемое textarea; пользователь вставляет regex любым способом (Ctrl+V, кнопка, ввод с клавиатуры).
- **Высота поля:** без ограничения по максимуму; пользователь может раскрывать поле вручную (resize: vertical) по своему усмотрению.

### 3.2 Кнопка «Вставить»

- Рядом с полем — кнопка «Вставить» для вставки из буфера обмена (`navigator.clipboard.readText()`).
- Браузер может запрашивать разрешение; поддержать и кнопку, и Ctrl+V.

### 3.3 Визуализация

- Только **по кнопке** «Визуализировать»; автовизуализация при каждом изменении поля не требуется.

---

## 4. Диаграмма (railroad diagram)

### 4.1 Референс

- Визуальная совместимость с [regexper.com](https://regexper.com/) **обязательна**.
- Референс по элементам и чтению: [regexper.com/documentation.html](https://regexper.com/documentation.html).

### 4.2 Элементы диаграммы (по Regexper)

- **Literals** — литералы (точное совпадение текста); светлые боксы с содержимым в кавычках.
- **Escape sequences** — escape-последовательности; отдельный цвет (зелёный в Regexper), описание типа символов.
- **Any character** — «любой символ», аналогично escape.
- **Character sets** — наборы символов: «One of» / «None of».
- **Subexpressions** — подвыражения с пунктирной рамкой; захватываемые группы — номер группы; lookahead/lookbehind — подписи.
- **Alternation** — альтернация, ветвление путей.
- **Quantifiers** — квантификаторы: zero-or-more, required, optional, range; подписи greedy / non-greedy.

### 4.3 Визуальный стиль

- Семантика и разметка как в Regexper (линии, скругления, стрелки, labels для greedy/non-greedy).
- Поле вывода диаграммы — белое, скруглённое, без отдельной рамки; группы — пунктирная рамка; линии и блоки с контрастной палитрой (regexper-overrides.css), без сплошной чёрной заливки у соединительных path.
- **Подзаголовок панели:** «Введите регулярное выражение и нажмите «Визуализировать» для построения диаграммы.»
- **До построения:** тёмный приветственный экран с подсказкой. **Во время построения (загрузка):** сразу показываются белое поле диаграммы, по центру — анимация загрузки (три пульсирующие точки) и панель экспорта/зума внизу (без мигания). **После построения:** диаграмма на белом фоне, панель остаётся на месте.
- **Кнопка «Раскрыть на весь экран»:** текст на кнопке — «Раскрыть на весь экран» (одна длинная строка, без переноса); одного размера с кнопкой «Скачать» и кнопками зума.
- Отступы: увеличенный padding области (36px) и патч в regexper.js (padding 10→16, 5→8) дают «охранные поля» между элементами, без наложения.
- Цвета — под палитру сайта RegexHelper (литералы, escape, anchor, repeat, группы, линии); элементы не сливаются с фоном.

### 4.4 Пан (перемещение)

- **ЛКМ + перетаскивание** для перемещения диаграммы по вертикали и горизонтали (не правая кнопка).

### 4.5 Скролл и zoom

- Диаграмма центрируется в окне вывода; горизонтальный и вертикальный скролл внутри области диаграммы доступен по всей области (в т.ч. при зуме); при зуме область прокрутки задаётся явно, диаграмма не обрезается.
- Zoom 25%–300%, масштаб от левого верхнего угла — при увеличении можно доскроллить до всех краёв.
- **Расчёт размеров:** размеры SVG получаются через `getBBox()` или `viewBox` (не через `offsetWidth/Height` контейнера); к масштабированным размерам добавляется padding области (36px × 2 = 72px), чтобы контейнеры имели корректные размеры для полной прокрутки.
- При генерации новой диаграммы зум сбрасывается на 100%.
- Кнопки «Уменьшить» и «Увеличить» для управления масштабом; на кнопках — подсказка (title) о возможности менять масштаб колёсиком мыши при зажатой клавише Ctrl.
- **Масштаб по Ctrl + колёсико мыши** в области диаграммы и в модальном окне на весь экран.

---

## 5. Экспорт

### 5.1 Форматы и UI

- **Одна кнопка «Скачать»:** по клику раскрывается выпадающее меню вправо по горизонтали с пунктами **SVG** и **PNG** (все три элемента в одну линию, равные отступы). Меню открывается плавно (transition opacity); без дополнительной обводки контейнера — только кнопки.
- Форматы **SVG** и **PNG** — оба; логика экспорта без изменений (SVG/PNG из текущего SVG с встроенными стилями).

### 5.2 Имя файла

- Фиксированный формат: `diagram_DD-MM-YYYY_HH-mm.svg` (локальное время, без часового пояса).
- Пример: `diagram_17-02-2026_14-30.svg`.

---

## 6. Техническая реализация

### 6.1 Источник логики диаграмм

- Использовать **готовую библиотеку** или форк с открытым кодом (javallone/regexper, bubkoo/regexper, AkatQuas/regexper-ng).
- Лицензия: только бесплатная (MIT, Apache и т.п.).
- Цель: визуальная совместимость с regexper.com.

### 6.2 Поддерживаемый синтаксис

- Как у Regexper: JavaScript RegExp и всё, что Regexper поддерживает (флаги, группы, lookahead/lookbehind и т.д.).

### 6.3 Обработка ошибок

- При невалидном regex: **toast-уведомление** с текстом ошибки.
- Не прерывать работу приложения; пользователь может продолжить ввод и попробовать снова.

---

## 7. Дополнительные элементы

- **Permalink** (копировать ссылку) — **не требуется**.
- **Примеры** (кнопка «Вставить пример») — **не требуется**.

---

## 8. Responsive

- Только **desktop**; отдельной адаптации для мобильных экранов нет (как и для всего сайта).

---

## 9. Файловая структура (план)

```
tools/visualizer/
├── app.js           # Инициализация визуализатора
├── logic/           # Логика парсинга/построения диаграмм
├── ui/              # UI-компоненты (поле ввода, область диаграммы, zoom, экспорт)
└── css/             # Стили визуализатора (см. docs/visualizer/ARCHITECTURE.md)
```
