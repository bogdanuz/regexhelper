# Архитектура конвертера — RegexHelper

Краткий обзор: как устроены модули, как данные проходят от UI к результату.

**Связанные документы:** docs/USER_REGEX_EXAMPLES_REFERENCE.md (эталон синтаксиса и примеров regex), docs/DEPENDENCY_MAP.md (граф зависимостей), docs/STRUCTURE.md (структура репо).

---

## Точка входа

- **index.html** загружает **main.js** (ES-модуль).
- **main.js** импортирует **tools/converter/app.js**, **tools/visualizer/app.js**, **tools/case/app.js** и **tools/tester/app.js**, вызывает `initApp()`, `initVisualizer()`, `initCase()` и `initTester()`.
- **app.js** подключает UI (модалки, настройки, панель результата, историю, переключаемую панель триггеров) и логику конвертации.

## Переключаемая панель триггеров

Простые и связанные триггеры размещены в **одной панели с переключением режима**:
- По умолчанию активен режим «Связанные триггеры».
- Клик по заголовку панели переключает между «Простые триггеры» и «Связанные триггеры».
- Визуальные отличия: цвет верхней границы (бирюзовый — простые, фиолетовый — связанные).
- При переключении данные сохраняются (не очищаются).
- Конвертируется только активный режим.

### Связанные триггеры — визуальный конструктор (LinkedBuilder)

Панель «Связанные триггеры» — **конструктор регулярных выражений со сложными связями** (`tools/converter/ui/linkedBuilder.js`):

- **Интерфейс:** левая интерактивная зона (чипы триггеров, соединители, группы) + правая панель параметров.
- **Чипы триггеров:** компактные блоки; двойной клик — редактирование; крестик — удаление.
- **Drag & Drop:** перетаскивание мышью для изменения порядка; индикация позиции вставки.
- **Соединители:** бейджи между элементами (`|`, `[\s\S]+`, `.+`, `[^\n]+`, `.{min,max}`); по умолчанию — альтернация.
- **Группы:** выбор нескольких соседних элементов → «Сгруппировать ( )»; цветные рамки; вложенность.
- **Действия с группой:** Дублировать, Инвертировать, Разгруппировать, Удалить (появляются только при выборе группы).
- **Параметры:** Лат/Кир, Транслит, Склонения, (\w), (\b), (\s) — бейджи под чипами; конфликтующие параметры снимаются автоматически.
- **Нумерация строк:** при 2+ визуальных строках показываются номера в кружочках (18×18px), вертикальная пунктирная линия-разделитель и индикатор «продолжение →» в конце каждой строки (кроме последней).
- **Конвертация:** через `linkedBuilderConverter.js`.
- **Сохранение:** автоматически в localStorage.

---

## Поток данных

1. **Простые триггеры:** textarea → **simpleConverter** + **parameterApplier** → regex.
2. **Связанные триггеры:** linkedBuilder data → **linkedBuilderConverter** → regex.
3. **conversionManager** координирует оба пути, собирает итоговый regex.

---

## Ключевые модули

| Модуль | Назначение |
|--------|------------|
| **conversionManager.js** | Оркестрация: вызов simple конвертера, сборка итога, сохранение в историю. |
| **simpleConverter.js** | Конвертация текстового списка триггеров в regex. |
| **linkedBuilderConverter.js** | Конвертация данных LinkedBuilder в regex. |
| **parameterApplier.js** | Применение параметров к триггерам. |
| **regexBuilder.js** | Сборка итоговой regex-строки. |
| **distanceBuilder.js** | Паттерны соединителей между словами. |
| **compatibilityChecker.js** | Проверка совместимости параметров. |
| **resultFormatter.js** | Форматирование результата для UI. |

**Converters:**
- **autoReplace.js** — автозамены ё→[её], ь→[ьъ], ъ→[ъь]
- **latinCyrillic.js** — латиница/кириллица
- **transliteration.js** — транслитерация
- **declensions.js** — склонения (авто/точные)
- **wildcard.js** — любой символ (\w)
- **optionalChars.js** — опциональные символы

**UI:**
- **linkedBuilder.js** — визуальный конструктор связанных триггеров
- **modals.js** — модальные окна (WIKI, confirm)
- **settingsUI.js** — настройки
- **resultPanel.js** — панель результата
- **historyUI.js** — история конвертаций
- **badges.js** — бейджи параметров
- **inlinePopup.js** — popup настроек триггера

---

## Папки

- **core/** — конфигурация, иконки, общие стили
- **shared/** — утилиты, контент (WIKI), уведомления
- **tools/converter/** — весь код конвертера
  - **logic/** — бизнес-логика
  - **converters/** — правила преобразования
  - **ui/** — интерфейс
  - **css/** — стили

---

## Удалённые модули (аудит 2026-02-21)

| Файл | Причина удаления |
|------|------------------|
| groupManager.js | Заменён на linkedBuilder.js |
| triggerManager.js | Заменён на linkedBuilder.js |
| dragDrop.js | Встроено в linkedBuilder.js |
| distanceDropdown.js | Заменён на inline popup |
| linkedConverter.js | Заменён на linkedBuilderConverter.js |
| prefix.js | Функционал заменён параметром \w |

Граф зависимостей по файлам: **docs/DEPENDENCY_MAP.md**.
